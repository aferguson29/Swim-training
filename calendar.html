<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Workout Calendar</title>
  <style>
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background: linear-gradient(to bottom right, #0077b6, #90e0ef);
      color: #333;
      padding: 1rem;
    }
    h1 {
      text-align: center;
      color: white;
    }
    .calendar-container {
      max-width: 500px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      padding: 1rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    .month-header {
      text-align: center;
      font-weight: bold;
      margin-bottom: 0.5rem;
    }
    .weekdays, .days {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      text-align: center;
    }
    .weekdays div {
      font-weight: bold;
      color: #0077b6;
    }
    .day {
      padding: 0.5rem;
      margin: 0.25rem;
      border-radius: 8px;
      background: #f1f1f1;
      cursor: pointer;
      position: relative;
    }
    .day.today {
      font-weight: bold;
      background: #caf0f8;
    }
    .emoji {
      font-size: 1.2rem;
      position: absolute;
      bottom: 4px;
      right: 4px;
    }
    .summary {
      margin-top: 1rem;
      background: white;
      border-radius: 8px;
      padding: 1rem;
      text-align: center;
    }
    .summary span {
      display: block;
      margin-bottom: 0.25rem;
    }
    .footer {
      display: flex;
      justify-content: center;
      margin-top: 1rem;
    }
    .footer button {
      background: white;
      color: #0077b6;
      border: none;
      padding: 0.75rem 1.25rem;
      font-size: 1rem;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    #inputModal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 1rem;
      border-radius: 12px;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
      display: none;
      z-index: 1000;
      max-width: 90%;
      width: 300px;
    }
    #inputModal label, #inputModal select, #inputModal input {
      display: block;
      width: 100%;
      margin-bottom: 0.5rem;
      font-size: 1rem;
    }
    #inputModal button {
      margin-top: 0.5rem;
      width: 100%;
    }
  </style>
</head>
<body>
  <h1>Workout Calendar</h1>
  <div class="calendar-container">
    <div class="month-header" id="monthYear"></div>
    <div class="weekdays">
      <div>M</div><div>T</div><div>W</div><div>T</div><div>F</div><div>S</div><div>S</div>
    </div>
    <div class="days" id="calendarDays"></div>
    <div class="summary" id="monthlySummary"></div>
  </div>
  <div class="footer">
    <button onclick="goBack()">Back to Main Menu</button>
  </div>

  <div id="inputModal">
    <label for="workoutType">Workout Type:</label>
    <select id="workoutType">
      <option value="">Select</option>
      <option value="run">ğŸƒâ€â™‚ï¸ Run</option>
      <option value="bike">ğŸš´â€â™‚ï¸ Bike</option>
      <option value="swim">ğŸŠâ€â™‚ï¸ Swim</option>
      <option value="weights">ğŸ‹ï¸â€â™‚ï¸ Weights</option>
      <option value="hockey">ğŸ‘ Hockey</option>
    </select>

    <input type="number" id="distance" placeholder="Distance (km)" style="display:none;">
    <input type="number" id="duration" placeholder="Time (min)" style="display:none;">

    <select id="weightsType" style="display:none;">
      <option value="">Select Weights Type</option>
      <option value="push">Push</option>
      <option value="pull">Pull</option>
      <option value="legs">Legs</option>
    </select>

    <button onclick="saveWorkout()">Save</button>
    <button onclick="closeModal()">Back</button>
  </div>

  <script>
    const calendarDays = document.getElementById("calendarDays");
    const monthYear = document.getElementById("monthYear");
    const summary = document.getElementById("monthlySummary");
    const inputModal = document.getElementById("inputModal");
    const workoutType = document.getElementById("workoutType");
    const distance = document.getElementById("distance");
    const duration = document.getElementById("duration");
    const weightsType = document.getElementById("weightsType");
    let selectedDate;

    const emojis = {
      run: "ğŸƒâ€â™‚ï¸",
      bike: "ğŸš´â€â™‚ï¸",
      swim: "ğŸŠâ€â™‚ï¸",
      weights: "ğŸ‹ï¸â€â™‚ï¸",
      hockey: "ğŸ‘"
    };

    function loadCalendar(date = new Date()) {
      calendarDays.innerHTML = "";
      const year = date.getFullYear();
      const month = date.getMonth();
      const today = new Date();
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      monthYear.textContent = `${date.toLocaleString('default', { month: 'long' })} ${year}`;

      let start = firstDay.getDay();
      if (start === 0) start = 7;
      for (let i = 1; i < start; i++) {
        calendarDays.innerHTML += `<div></div>`;
      }

      const workouts = JSON.parse(localStorage.getItem("calendarWorkouts") || "{}");

      for (let d = 1; d <= lastDay.getDate(); d++) {
        const thisDate = new Date(year, month, d);
        const dateStr = thisDate.toISOString().split('T')[0];
        const isToday = thisDate.toDateString() === today.toDateString();

        let icon = "";
        if (workouts[dateStr]) {
          icon = emojis[workouts[dateStr].type] || "";
        }

        calendarDays.innerHTML += `<div class="day ${isToday ? 'today' : ''}" onclick="openModal('${dateStr}')">${d}<span class="emoji">${icon}</span></div>`;
      }

      updateSummary(workouts, month, year);
    }

    function updateSummary(data, month, year) {
      let swimDist = 0, runDist = 0, bikeDist = 0;
      let swimTime = 0, runTime = 0, bikeTime = 0, weightsCount = 0, hockeyCount = 0;

      for (const [dateStr, entry] of Object.entries(data)) {
        const entryDate = new Date(dateStr);
        if (entryDate.getMonth() === month && entryDate.getFullYear() === year) {
          if (entry.type === "swim") {
            swimDist += entry.distance || 0;
            swimTime += entry.duration || 0;
          } else if (entry.type === "run") {
            runDist += entry.distance || 0;
            runTime += entry.duration || 0;
          } else if (entry.type === "bike") {
            bikeDist += entry.distance || 0;
            bikeTime += entry.duration || 0;
          } else if (entry.type === "weights") {
            weightsCount++;
          } else if (entry.type === "hockey") {
            hockeyCount++;
          }
        }
      }

      summary.innerHTML = `
        <span>ğŸŠâ€â™‚ï¸ Swim â€“ ${swimDist} km in ${swimTime} min</span>
        <span>ğŸƒâ€â™‚ï¸ Run â€“ ${runDist} km in ${runTime} min</span>
        <span>ğŸš´â€â™‚ï¸ Bike â€“ ${bikeDist} km in ${bikeTime} min</span>
        <span>ğŸ‹ï¸â€â™‚ï¸ Weights â€“ ${weightsCount} sessions</span>
        <span>ğŸ‘ Hockey â€“ ${hockeyCount} sessions</span>
      `;
    }

    function openModal(date) {
      selectedDate = date;
      inputModal.style.display = "block";
    }

    function closeModal() {
      inputModal.style.display = "none";
      workoutType.value = "";
      distance.value = "";
      duration.value = "";
      weightsType.value = "";
      distance.style.display = "none";
      duration.style.display = "none";
      weightsType.style.display = "none";
    }

    workoutType.addEventListener("change", () => {
      distance.style.display = "none";
      duration.style.display = "none";
      weightsType.style.display = "none";
      if (["run", "bike", "swim"].includes(workoutType.value)) {
        distance.style.display = "block";
        duration.style.display = "block";
      } else if (workoutType.value === "weights") {
        weightsType.style.display = "block";
      }
    });

    function saveWorkout() {
      const type = workoutType.value;
      if (!type) return alert("Select a workout type");
      const workout = { type };
      if (["run", "bike", "swim"].includes(type)) {
        workout.distance = parseFloat(distance.value) || 0;
        workout.duration = parseFloat(duration.value) || 0;
      } else if (type === "weights") {
        workout.subtype = weightsType.value;
      }

      const data = JSON.parse(localStorage.getItem("calendarWorkouts") || "{}");
      data[selectedDate] = workout;
      localStorage.setItem("calendarWorkouts", JSON.stringify(data));
      closeModal();
      loadCalendar(new Date(selectedDate));
    }

    function goBack() {
      window.location.href = "index.html";
    }

    loadCalendar();
  </script>
</body>
</html>