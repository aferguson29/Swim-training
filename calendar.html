<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Workout Calendar</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      margin: 0;
      padding: 1rem;
      background: #f4f9fd;
      color: #333;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    h1 {
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
    }

    .month-header {
      font-size: 1.2rem;
      margin-bottom: 0.5rem;
    }

    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 0.5rem;
      width: 100%;
      max-width: 400px;
      margin-top: 0.5rem;
    }

    .day-name {
      font-weight: bold;
      text-align: center;
    }

    .day {
      height: 50px;
      background: white;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
      cursor: pointer;
      position: relative;
    }

    .today {
      border: 2px solid #007aff;
    }

    .emoji {
      position: absolute;
      bottom: 2px;
      font-size: 0.8rem;
    }

    .controls {
      margin-top: 1rem;
      display: flex;
      gap: 1rem;
    }

    .summary {
      margin-top: 1rem;
      width: 100%;
      max-width: 400px;
      background: white;
      padding: 1rem;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    .summary h3 {
      margin-top: 0;
    }

    .workout-entry {
      margin-top: 1rem;
      padding: 1rem;
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background: white;
      padding: 1rem;
      border-radius: 10px;
      width: 90%;
      max-width: 300px;
    }

    .modal-content label, .modal-content select, .modal-content input {
      display: block;
      width: 100%;
      margin-bottom: 0.5rem;
    }
  </style>
</head>
<body>
  <h1>Workout Calendar</h1>
  <div class="month-header" id="monthHeader"></div>
  <div class="calendar" id="calendar"></div>
  <div class="controls">
    <button onclick="changeMonth(-1)">Last Month</button>
    <button onclick="changeMonth(1)">Next Month</button>
  </div>

  <div class="summary" id="summary"></div>

  <div class="modal" id="workoutModal">
    <div class="modal-content">
      <h3 id="selectedDateDisplay"></h3>
      <label for="workoutType">Workout Type</label>
      <select id="workoutType">
        <option value="run">🏃‍♂️ Run</option>
        <option value="bike">🚴‍♂️ Bike</option>
        <option value="swim">🏊‍♂️ Swim</option>
        <option value="weights">🏋️‍♂️ Weights</option>
        <option value="hockey">🏑 Hockey</option>
      </select>

      <div id="distanceTimeFields">
        <label for="distance">Distance (km)</label>
        <input type="number" id="distance" />
        <label for="duration">Duration (min)</label>
        <input type="number" id="duration" />
      </div>

      <div id="weightsFields" style="display:none;">
        <label for="weightsType">Weights Type</label>
        <select id="weightsType">
          <option value="push">Push</option>
          <option value="pull">Pull</option>
          <option value="legs">Legs</option>
        </select>
      </div>

      <button onclick="saveWorkout()">Save</button>
      <button onclick="closeModal()">Back</button>
    </div>
  </div>

  <script>
    let currentDate = new Date();

    function getStoredWorkouts() {
      return JSON.parse(localStorage.getItem('calendarWorkouts') || '{}');
    }

    function saveStoredWorkouts(data) {
      localStorage.setItem('calendarWorkouts', JSON.stringify(data));
    }

    function updateCalendar() {
      const calendar = document.getElementById('calendar');
      const monthHeader = document.getElementById('monthHeader');
      calendar.innerHTML = '';

      const year = currentDate.getFullYear();
      const month = currentDate.getMonth();
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      const startDay = firstDay.getDay();

      const weekdays = ['S','M','T','W','T','F','S'];
      weekdays.forEach(day => {
        const div = document.createElement('div');
        div.className = 'day-name';
        div.textContent = day;
        calendar.appendChild(div);
      });

      monthHeader.textContent = `${firstDay.toLocaleString('default', { month: 'long' })} ${year}`;

      for (let i = 0; i < startDay; i++) {
        calendar.appendChild(document.createElement('div'));
      }

      const workouts = getStoredWorkouts();

      for (let i = 1; i <= lastDay.getDate(); i++) {
        const date = new Date(year, month, i);
        const dateStr = date.toISOString().split('T')[0];
        const div = document.createElement('div');
        div.className = 'day';
        if (date.toDateString() === new Date().toDateString()) div.classList.add('today');
        div.textContent = i;

        if (workouts[dateStr]) {
          const emoji = workouts[dateStr].map(w => {
            if (w.type === 'run') return '🏃‍♂️';
            if (w.type === 'bike') return '🚴‍♂️';
            if (w.type === 'swim') return '🏊‍♂️';
            if (w.type === 'weights') return '🏋️‍♂️';
            if (w.type === 'hockey') return '🏑';
          }).join('');
          const emojiDiv = document.createElement('div');
          emojiDiv.className = 'emoji';
          emojiDiv.textContent = emoji;
          div.appendChild(emojiDiv);
        }

        div.onclick = () => openModal(dateStr);
        calendar.appendChild(div);
      }

      updateSummary(workouts);
    }

    function changeMonth(offset) {
      currentDate.setMonth(currentDate.getMonth() + offset);
      updateCalendar();
    }

    function openModal(dateStr) {
      document.getElementById('workoutModal').style.display = 'flex';
      document.getElementById('selectedDateDisplay').textContent = dateStr;
      document.getElementById('distance').value = '';
      document.getElementById('duration').value = '';
      document.getElementById('weightsFields').style.display = 'none';
      document.getElementById('distanceTimeFields').style.display = 'block';
    }

    function closeModal() {
      document.getElementById('workoutModal').style.display = 'none';
    }

    document.getElementById('workoutType').addEventListener('change', function() {
      const type = this.value;
      document.getElementById('weightsFields').style.display = type === 'weights' ? 'block' : 'none';
      document.getElementById('distanceTimeFields').style.display = type === 'weights' || type === 'hockey' ? 'none' : 'block';
    });

    function saveWorkout() {
      const dateStr = document.getElementById('selectedDateDisplay').textContent;
      const type = document.getElementById('workoutType').value;
      const distance = parseFloat(document.getElementById('distance').value) || 0;
      const duration = parseFloat(document.getElementById('duration').value) || 0;
      const weightsType = document.getElementById('weightsType').value;

      const workouts = getStoredWorkouts();
      if (!workouts[dateStr]) workouts[dateStr] = [];

      const entry = { type };
      if (type === 'run' || type === 'bike' || type === 'swim') {
        entry.distance = distance;
        entry.duration = duration;
      } else if (type === 'weights') {
        entry.weightsType = weightsType;
      }

      workouts[dateStr].push(entry);
      saveStoredWorkouts(workouts);
      closeModal();
      updateCalendar();
    }

    function updateSummary(workouts) {
      const summary = document.getElementById('summary');
      let swimDist = 0, swimTime = 0, runDist = 0, runTime = 0, bikeDist = 0, bikeTime = 0, weightsCount = 0, hockeyCount = 0;
      for (const date in workouts) {
        const dateObj = new Date(date);
        if (dateObj.getMonth() !== currentDate.getMonth() || dateObj.getFullYear() !== currentDate.getFullYear()) continue;
        workouts[date].forEach(w => {
          if (w.type === 'swim') { swimDist += w.distance || 0; swimTime += w.duration || 0; }
          if (w.type === 'run') { runDist += w.distance || 0; runTime += w.duration || 0; }
          if (w.type === 'bike') { bikeDist += w.distance || 0; bikeTime += w.duration || 0; }
          if (w.type === 'weights') weightsCount++;
          if (w.type === 'hockey') hockeyCount++;
        });
      }

      summary.innerHTML = `
        <h3>Monthly Summary</h3>
        🏊‍♂️ Swim – ${swimDist.toFixed(1)} km, ${swimTime.toFixed(1)} min<br>
        🏃‍♂️ Run – ${runDist.toFixed(1)} km, ${runTime.toFixed(1)} min<br>
        🚴‍♂️ Bike – ${bikeDist.toFixed(1)} km, ${bikeTime.toFixed(1)} min<br>
        🏋️‍♂️ Weights – ${weightsCount} sessions<br>
        🏑 Hockey – ${hockeyCount} sessions
      `;
    }

    updateCalendar();
  </script>
</body>
</html>