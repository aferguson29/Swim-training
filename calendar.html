<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Workout Calendar</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      margin: 0;
      padding: 2rem;
      background: linear-gradient(to bottom right, #0077b6, #90e0ef);
      color: white;
      text-align: center;
    }
    h1 {
      font-size: 2rem;
      margin-bottom: 1rem;
    }
    .calendar-wrapper {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }
    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 0.5rem;
      width: 100%;
      max-width: 600px;
    }
    .day {
      background: white;
      color: #0077b6;
      border-radius: 10px;
      padding: 0.5rem;
      min-height: 80px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
    }
    .day.today {
      border: 2px solid red;
      font-weight: bold;
    }
    .icons {
      font-size: 1.25rem;
    }
    .summary {
      margin-top: 2rem;
      font-size: 1rem;
    }
    button {
      font-size: 1rem;
      margin: 1rem 0.5rem;
      padding: 0.75rem 1.25rem;
      border: none;
      border-radius: 10px;
      color: #0077b6;
      background: white;
      cursor: pointer;
    }
    .days-labels {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      max-width: 600px;
      margin: auto;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>Workout Calendar</h1>
  <div class="calendar-wrapper">
    <div class="calendar-header">
      <button onclick="changeMonth(-1)">Last Month</button>
      <div id="monthHeader"></div>
      <button onclick="changeMonth(1)">Next Month</button>
    </div>
    <div class="days-labels">
      <div>M</div><div>T</div><div>W</div><div>T</div><div>F</div><div>S</div><div>S</div>
    </div>
    <div class="calendar-grid" id="calendar"></div>
    <div class="summary" id="monthlySummary"></div>
    <button onclick="goBack()">Exit</button>
  </div>

  <script>
    let currentDate = new Date();

    function formatDate(date) {
      return date.toISOString().split("T")[0];
    }

    function getWorkouts() {
      return JSON.parse(localStorage.getItem("calendarWorkouts")) || {};
    }

    function saveWorkouts(workouts) {
      localStorage.setItem("calendarWorkouts", JSON.stringify(workouts));
    }

    function renderCalendar() {
      const year = currentDate.getFullYear();
      const month = currentDate.getMonth();
      const today = new Date();
      const workouts = getWorkouts();

      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      const startDay = (firstDay.getDay() + 6) % 7; // Adjust to make Monday the first day

      const calendarEl = document.getElementById("calendar");
      calendarEl.innerHTML = "";

      const monthHeader = document.getElementById("monthHeader");
      monthHeader.textContent = `${currentDate.toLocaleString("default", {
        month: "long",
      })} ${year}`;

      for (let i = 0; i < startDay; i++) {
        const blank = document.createElement("div");
        calendarEl.appendChild(blank);
      }

      for (let day = 1; day <= lastDay.getDate(); day++) {
        const date = new Date(year, month, day);
        const iso = formatDate(date);

        const div = document.createElement("div");
        div.classList.add("day");
        if (
          date.toDateString() === today.toDateString() &&
          date.getMonth() === today.getMonth()
        ) {
          div.classList.add("today");
        }

        const icons = renderIcons(workouts[iso] || []);
        div.innerHTML = `<div>${day}</div><div class="icons">${icons}</div>`;
        calendarEl.appendChild(div);
      }

      renderSummary(workouts, month, year);
    }

    function renderIcons(entries) {
      return entries
        .map((e) => {
          switch (e.type) {
            case "run":
              return "üèÉ‚Äç‚ôÇÔ∏è";
            case "bike":
              return "üö¥‚Äç‚ôÇÔ∏è";
            case "swim":
              return "üèä‚Äç‚ôÇÔ∏è";
            case "weights":
              return "üèãÔ∏è‚Äç‚ôÇÔ∏è";
            case "hockey":
              return "üèë";
            default:
              return "";
          }
        })
        .join(" ");
    }

    function renderSummary(data, month, year) {
      let swim = 0,
        bike = 0,
        run = 0;
      let swimTime = 0,
        bikeTime = 0,
        runTime = 0,
        weights = 0,
        hockey = 0;

      Object.entries(data).forEach(([dateStr, entries]) => {
        const date = new Date(dateStr);
        if (date.getMonth() === month && date.getFullYear() === year) {
          entries.forEach((entry) => {
            switch (entry.type) {
              case "swim":
                swim += entry.distance || 0;
                swimTime += entry.time || 0;
                break;
              case "bike":
                bike += entry.distance || 0;
                bikeTime += entry.time || 0;
                break;
              case "run":
                run += entry.distance || 0;
                runTime += entry.time || 0;
                break;
              case "weights":
                weights++;
                break;
              case "hockey":
                hockey++;
                break;
            }
          });
        }
      });

      const summaryEl = document.getElementById("monthlySummary");
      summaryEl.innerHTML = `
        <div>üèä‚Äç‚ôÇÔ∏è Swim: ${swim}m, ${swimTime}min</div>
        <div>üö¥‚Äç‚ôÇÔ∏è Bike: ${bike}m, ${bikeTime}min</div>
        <div>üèÉ‚Äç‚ôÇÔ∏è Run: ${run}m, ${runTime}min</div>
        <div>üèãÔ∏è‚Äç‚ôÇÔ∏è Weights: ${weights} sessions</div>
        <div>üèë Hockey: ${hockey} sessions</div>
      `;
    }

    function changeMonth(offset) {
      currentDate.setMonth(currentDate.getMonth() + offset);
      renderCalendar();
    }

    function goBack() {
      window.location.href = "index.html";
    }

    renderCalendar();
  </script>
</body>
</html>
